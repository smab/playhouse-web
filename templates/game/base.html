<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <title>{{ title }}</title>
        <link rel="stylesheet" type="text/css" href="/static/game-base.css" />
	<link rel="stylesheet" type="text/css" href="/static/retina.css"
              media="only screen and (-moz-min-device-pixel-ratio: 2),
                     only screen and (-o-min-device-pixel-ratio: 2/1),
                     only screen and (-webkit-min-device-pixel-ratio: 2),
                     only screen and (min-device-pixel-ratio: 2)"
              /><!-- Could move to game-base.css  with viewports instead of retina.css-->
        <style>
            #grid td {
                min-width:  {{ cell_w }}px;
                width:      {{ cell_w }}px;
                min-height: {{ cell_h }}px;
                height:     {{ cell_h }}px;
            }

            #grid           { background: #000;                    }
            #grid img       { background-color: {{ color_empty }}; }
            #grid img:hover { background-color: {{ color_hover }}; }

            {% block style %}
            {% end %}
        </style>
        <script>
            var config = {
                grid_x: {{ grid_x }},
                grid_y: {{ grid_y }}
            }
        </script>
    </head>
    <body>
        <!--
        {% block queue %}
        <div id="queue" class="box">
            <p id="queuemsg">Connecting to queue...</p>
        </div>
        {% end %}
        -->

        <h1>{{ title }}</h1>

        {% block grid %}
            {% block overlay %}
            <div id="overlay" class="hidden">
                <div>The game got destroyed!</div>
            </div>
            {% end %}

            {% block message-area %}
            <div id="message-box" class="box">
                <div id="message">Connecting...</div>
                {% block queue-btn %}
                <input type="button" id="queuebtn" value="Join queue" />
                {% end %}
            </div>
            {% end %}

            <table id="grid"></table>

            {% block postgrid %}
            <div style="text-align:center">
                {% raw stream_embedcode %}
            </div>
            {% end %}

            {% block rules %}
            {% end %}
        {% end %}

        <script>
            var socketport = {{ socketport }}
            function on_message(obj) {
                {% block rulemessage%}
                {% end %}

                {% block message %}
                {% end %}

                {% block queuemsg %}
                session = "{{ gamesession }}" // to lazy to use the cookie value
                handle_queue_msg(obj)
                {% end %}
            }

            function play() {
                var coords = this.id.split("-")

                function reply(response) {
                    ws.send(JSON.stringify(extend({ gameaction: true }, response)))
                }

                {% block click %}
                {% end %}

                function extend(target, source) {
                    for (var k in source) target[k] = source[k]
                    return target
                }
            }

            {% block script %}
            {% end %}
        </script>
        <script src="/static/game-base.js"></script>
    </body>
</html>
