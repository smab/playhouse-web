<!DOCTYPE html>

<html>
    <head>
        <title>{% block title %}Base{% end %}</title>
        <style>
            body {
              background: #235;
            }

            /*** Grid ************************************/
            #grid {
                margin: 4em auto;
                padding: 0.4em;
                border-radius: 8px;
                box-shadow: 0 0 16px #000;
            }

            #grid td {
                position: relative;
                margin: 0;
                padding: 0;

                width: {{ cell_w }}px;
                height: {{ cell_h }}px;
            }
            #grid td::after {
                display: block;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                content: "";
            }

            #grid           { background: #000;                    }
            #grid td::after { background: url('/static/lamp.png'); }
            #grid td        { background-color: #222;              }
            #grid td:hover  { background-color: #999;              }


            /*** Queue ***********************************/
            div#queue {
                text-align: center;
                border-style: solid;
                border-width: 1px;
                border-color: black;
                width: 200px;
                margin: auto;
                margin-top: 10px;
                padding: 10px;
                background-color: #FF66FF;
            }
            p#queuemsg {
                margin: 2px;
                color: black;
            }
            {% block style %}
            {% end %}
        </style>
        <script>
            window.onload = function() {
                var wsHost = document.location.hostname + ":" + 8080,
                    ws     = new WebSocket("ws://{}/websocket".replace(/{}/, wsHost))

                ws.onmessage = function (evt) {
                    {% block message %}
                    {% end %}

                    {% block queuemsg %}

                    if (obj.queuepos != undefined) {
                        qmsg = document.getElementById("queuemsg")
                        qbtn = document.getElementById("queuebtn")
                        if(obj.queuepos > 0) {
                            qmsg.innerHTML = "Your place in queue: " + obj.queuepos;
                            qbtn.value = "Leave queue";
                            qbtn.onclick = function() {
                                ws.send(JSON.stringify({ queueaction : 0 }));
                            }
                        } else {
                            qmsg.innerHTML = "You are not in the queue";
                            qbtn.value = "Join queue";
                            qbtn.onclick = function() {
                                ws.send(JSON.stringify({ queueaction : 1 }));
                            }
                        }
                    }

                    {% end %}
                };

                var table = document.getElementById("grid");
                for(var i=0; i<{{ grid_y }}; i++) {
                    // Create tr
                    var tr = document.createElement("tr");
                    for(var ii=0; ii<{{ grid_x }}; ii++) {
                        // Add td and function onclick
                        var td = document.createElement("td");
                        td.id = ii + "-" + i;
                        td.onclick = function() { play(this); };
                        tr.appendChild(td);
                    }

                    // Add tr to DOM
                    table.appendChild(tr);
                }

                function play(e) {
                    coords = e.id.split("-")

                    {% block click %}
                    {% end %}
                }
            }

            {% block script %}
            {% end %}
        </script>
    </head>
    <body>
        {% block grid %}
        <table id="grid"></table>

        {% block postgrid %}
        {% end %}

        {% end %}
        {% block queue %}
        <div id="queue">
            <p id="queuemsg">Connecting to queue...</p>
            <input type=button id="queuebtn" value="Join queue" />
        </div>
        {% end %}
    </body>
</html>
